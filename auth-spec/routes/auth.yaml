logout:
  post:
    summary: "Logout User"
    operationId: logoutUser
    tags:
      - auth
    responses:
      "200":
        description: Successful logout
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/LogoutResponse"

verify:
  get:
    summary: "Verify Authentication Status"
    description: "Used by Caddy for forward authentication. Verifies if the user is authenticated and adds user information headers for downstream services."
    operationId: verifyAuth
    tags:
      - auth
    responses:
      "200":
        description: User is authenticated
        headers:
          X-User-ID:
            schema:
              type: string
            description: The authenticated user's ID
          X-User-Email:
            schema:
              type: string
              format: email
            description: The authenticated user's email
          X-User-Scopes:
            schema:
              type: string
            description: Comma-separated list of user's permission scopes
          X-User-Email-Verified:
            schema:
              type: string
              enum: ["true", "false"]
            description: Whether the authenticated user's email is verified ('true' or 'false')
        content:
          application/json:
            schema:
              $ref: "../schemas/user.yaml"
      "401":
        description: User is not authenticated
        content:
          application/json:
            schema:
              $ref: "../schemas/error.yaml"
      "403":
        description: CSRF token mismatch
        content:
          application/json:
            schema:
              $ref: "../schemas/error.yaml"

forgot-password:
  post:
    summary: "Request Password Reset"
    operationId: forgotPassword
    tags:
      - auth
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ForgotPasswordRequest"
    responses:
      "200":
        description: If the user exists, a recovery email was sent
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ForgotPasswordResponse"
      "400":
        description: Invalid email format
        content:
          application/json:
            schema:
              $ref: "../schemas/error.yaml"

reset-password:
  post:
    summary: "Reset Password Using Token"
    operationId: resetPassword
    tags:
      - auth
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ResetPasswordRequest"
    responses:
      "200":
        description: Password successfully reset
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ResetPasswordResponse"
      "400":
        description: Invalid token or password
        content:
          application/json:
            schema:
              $ref: "../schemas/error.yaml"

verify-email:
  post:
    summary: "Verify Email Address"
    operationId: verifyEmail
    tags:
      - auth
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/VerificationRequest"
    responses:
      "200":
        description: Email verified successfully
        content:
          application/json:
            schema:
              $ref: "../schemas/user.yaml"
      "400":
        description: Invalid or expired token
        content:
          application/json:
            schema:
              $ref: "../schemas/error.yaml"
      "401":
        description: User not logged in
        content:
          application/json:
            schema:
              $ref: "../schemas/error.yaml"
      "403":
        description: User not authorized to verify email
        content:
          application/json:
            schema:
              $ref: "../schemas/error.yaml"

resend-verification:
  post:
    summary: "Resend Verification Email"
    operationId: resendVerification
    tags:
      - auth
    responses:
      "200":
        description: Verification email sent successfully
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ResendVerificationResponse"
      "401":
        description: User not logged in
        content:
          application/json:
            schema:
              $ref: "../schemas/error.yaml"

set-password:
  post:
    summary: "Change User Password"
    operationId: setPassword
    tags:
      - auth
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/SetPasswordRequest"
    responses:
      "200":
        description: Password changed successfully
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SetPasswordResponse"
      "401":
        description: User not logged in or invalid current password
        content:
          application/json:
            schema:
              $ref: "../schemas/error.yaml"

components:
  schemas:
    LogoutResponse:
      type: object
      additionalProperties: false

    ForgotPasswordRequest:
      type: object
      required:
        - email
      additionalProperties: false
      properties:
        email:
          type: string
          format: email

    ForgotPasswordResponse:
      type: object
      required:
        - success
        - message
      additionalProperties: false
      properties:
        success:
          type: boolean
        message:
          type: string
          description: A generic message indicating that if the user exists, a recovery email was sent

    ResendVerificationResponse:
      type: object
      required:
        - success
        - message
      additionalProperties: false
      properties:
        success:
          type: boolean
        message:
          type: string
          description: A generic message indicating that the verification email was sent

    ResetPasswordRequest:
      type: object
      required:
        - token
        - newPassword
      additionalProperties: false
      properties:
        token:
          type: string
          description: The temporary password token received via email
        newPassword:
          type: string
          minLength: 8
          description: The new password to set

    ResetPasswordResponse:
      type: object
      required:
        - success
      additionalProperties: false
      properties:
        success:
          type: boolean

    VerificationRequest:
      type: object
      required:
        - token
      additionalProperties: false
      properties:
        token:
          type: string
          description: The verification token sent in the email

    SetPasswordRequest:
      type: object
      required:
        - currentPassword
        - newPassword
      additionalProperties: false
      properties:
        currentPassword:
          type: string
          description: The user's current password for verification
        newPassword:
          type: string
          minLength: 8
          description: The new password to set

    SetPasswordResponse:
      type: object
      required:
        - success
      additionalProperties: false
      properties:
        success:
          type: boolean
